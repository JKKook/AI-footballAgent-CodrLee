<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>AI-FootBallAgent</title>
        <link rel="stylesheet" href="./stylesheets/main.css" />
    </head>
    <body>
        <div class="container">
            <div class="title">
                <em>ChatGpt AIÏ±óÎ¥áÏóêÍ≤å Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî</em>
            </div>
            <div class="chat-box">
                <div class="chat-header">
                    <div class="chat-avatar">
                        <img
                            src="./assets/avatar2.png"
                            alt="profile"
                            class="avatar-img"
                        />
                    </div>
                    <div class="chat-info">
                        <h2 class="chat-name">Agent : CodrLee</h2>
                        <p class="chat-status">Ïò®ÎùºÏù∏ &nbsp; üü¢</p>
                    </div>
                </div>
                <div class="chat-body">
                    <div class="chat-message">
                        <p class="chat-mesage-intro">
                            ÏïàÎÖïÌïòÏÑ∏Ïöî! Ïñ¥Îñ§ Ïú†ÌòïÏùò Ï∂ïÍµ¨ÏÑ†ÏàòÍ∞Ä Í∂ÅÍ∏àÌïòÏã†Í∞ÄÏöî?
                        </p>
                        <button class="modal-btn">Option ÏÑ†ÌÉùÌïòÍ∏∞</button>
                        <div class="modal">
                            <div class="modal-content">
                                <span class="close">&times;</span>
                                <h2>Option ÏÑ†ÌÉù</h2>
                                <!-- select Box -->
                                <div
                                    class="select-box-container select-box-container-open"
                                >
                                    <div class="modal-background">
                                        <img
                                            src="./assets/manager.jpeg"
                                            alt="modal-background"
                                        />
                                    </div>
                                    <label for="yearOfBirth">Ïó∞ÎèÑ</label>
                                    <select id="yearOfBirth" name="yearOfBirth">
                                        <option value="">--ÏÑ†ÌÉù Ïó∞ÎèÑ--</option>
                                        <!-- ÏÉùÎÖÑÏõîÏùº option ÏÉùÏÑ± -->
                                    </select>

                                    <label for="league">Î¶¨Í∑∏</label>
                                    <select id="league" name="league">
                                        <option value="">--Î¶¨Í∑∏ ÏÑ†ÌÉù--</option>
                                        <optgroup label="Î¶¨Í∑∏">
                                            <option value="EPL">EPL</option>
                                            <option value="Laliga">
                                                Laliga
                                            </option>
                                            <option value="Bundesliga">
                                                Bundesliga
                                            </option>
                                            <option value="Serie A">
                                                Serie A
                                            </option>
                                            <option value="Ligue 1">
                                                Ligue 1
                                            </option>
                                            <option value="Eredivisie">
                                                Eredivisie
                                            </option>
                                        </optgroup>
                                    </select>

                                    <label for="position">Ìè¨ÏßÄÏÖò</label>
                                    <select id="position" name="position">
                                        <option value="">
                                            --Ìè¨ÏßÄÏÖò ÏÑ†ÌÉù--
                                        </option>
                                        <optgroup label="Í≥µÍ≤©Ïàò">
                                            <option value="FW">FW</option>
                                            <option value="ST">ST</option>
                                            <option value="CF">CF</option>
                                            <option value="LW">LW</option>
                                            <option value="RW">RW</option>
                                            <option value="SS">SS</option>
                                        </optgroup>
                                        <optgroup label="ÎØ∏ÎìúÌïÑÎçî">
                                            <option value="MF">MF</option>
                                            <option value="CM">CM</option>
                                            <option value="DM">CDM</option>
                                            <option value="AM">CAM</option>
                                            <option value="LM">LM</option>
                                            <option value="RM">RM</option>
                                        </optgroup>
                                        <optgroup label="ÏàòÎπÑÏàò">
                                            <option value="DF">DF</option>
                                            <option value="CB">CB</option>
                                            <option value="LB">LB</option>
                                            <option value="RB">RB</option>
                                            <option value="WB">LWB</option>
                                            <option value="WB">RWB</option>
                                        </optgroup>
                                        <optgroup label="Í≥®ÌÇ§Ìçº">
                                            <option value="GK">GK</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <button
                                    onclick="save()"
                                    class="select-save-btn"
                                >
                                    ÏÑ†ÌÉù Ï†ÄÏû•
                                </button>
                            </div>
                        </div>

                        <!-- ÎèôÏ†Å ÎùºÏö∞ÌåÖ -->

                        <div id="chat-log"></div>
                    </div>
                    <div id="loading" class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <div>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ëÏûÖÎãàÎã§...</div>
                    </div>
                </div>
                <div class="chat-footer">
                    <form class="input-form">
                        <input
                            type="text"
                            name="userInput"
                            placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                            class="chat-input"
                        />
                        <button type="submit" class="chat-send">Î≥¥ÎÇ¥Í∏∞</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="kakao-adfit">
            <ins
                class="kakao_ad_area"
                style="display: none"
                data-ad-unit="DAN-58H2nPTliu9s9Nn9"
                data-ad-width="320"
                data-ad-height="100"
            ></ins>
            <script
                type="text/javascript"
                src="//t1.daumcdn.net/kas/static/ba.min.js"
                async
            ></script>
        </div>

        <script>
            const BUILD_SERVER =
                'https://dwwyyi3n4rqi2eah7qkqhty2rq0zfnvr.lambda-url.ap-northeast-2.on.aws/api/chat';
            // const SERVER_URL = 'http://localhost:7003/api/chat';

            const chatLog = document.getElementById('chat-log'); // Ï±ÑÌåÖ Í∏∞Î°ùÏù¥ ÌëúÏãúÎê† div ÏóòÎ¶¨Î®ºÌä∏
            const form = document.querySelector('.input-form'); // form ÏóòÎ¶¨Î®ºÌä∏
            const chatInput = document.querySelector('.chat-input'); // Î©îÏãúÏßÄ ÏûÖÎ†• Ï∞Ω ÏóòÎ¶¨Î®ºÌä∏

            // HISTORY : serverÏóê Î∞∞Ïó¥ ÌòïÌÉúÎ°ú req.bodyÏóê Îç∞Ïù¥ÌÑ∞ Ï†ÑÎã¨
            let userMessages = [];
            let gptMessages = [];

            // string ÌòïÌÉúÎ°ú requestÏóê Ï†ÑÎã¨
            let selectOption = [];

            // select option save
            const save = () => {
                const optionBirth =
                    document.querySelector('#yearOfBirth').value;
                const optionLeague = document.querySelector('#league').value;
                const optionPosition =
                    document.querySelector('#position').value;

                let sumOption =
                    optionBirth +
                    '\u00a0' +
                    optionLeague +
                    '\u00a0' +
                    optionPosition +
                    '\u00a0';

                selectOption.push(sumOption);
                console.log(selectOption);

                if (selectOption) {
                    chatInput.value = `${sumOption}`;
                }
                modal.style.display = 'none';
            };

            // onClick Ïù¥Î≤§Ìä∏Î•º save Ìï®Ïàò Ìò∏Ï∂úÎ°ú ÏßÄÏ†ï
            document
                .querySelector('.select-save-btn')
                .addEventListener('click', () => {
                    // ÏûêÎèôÏ†ÅÏúºÎ°ú "Î≥¥ÎÇ¥Í∏∞" Î≤ÑÌäºÏù¥ ÎàåÎ†§ÏÑú request Î≥¥ÎÇº Ïàò ÏûàÎèÑÎ°ù
                    save();
                    handleSubmit();
                    // form.submit();
                });

            const handleSubmit = async () => {
                showLoading();
                // userInputÍ∞í Ï±ÑÌåÖ Î°úÍ∑∏Î•º ÏóÖÎç∞Ïù¥Ìä∏
                const userInput = chatInput.value; // ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûÖÎ†•Ìïú Í∞í
                const userMessage = document.createElement('div');
                userMessage.classList.add('user-message');
                userMessage.innerHTML = `<p>${userInput}</p>`;
                chatLog.appendChild(userMessage);

                // ** Message history - user
                userMessages.push(userInput);

                // Î©îÏãúÏßÄ ÏûÖÎ†• Ï∞ΩÏùÑ Ï¥àÍ∏∞Ìôî
                chatInput.value = '';

                // ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûÖÎ†•Ìïú Í∞íÏù¥ ÏóÜÏúºÎ©¥ Îçî Ïù¥ÏÉÅ Ïã§ÌñâÌïòÏßÄ ÏïäÏùå
                if (!userInput) {
                    return;
                }

                // ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûÖÎ†•Ìïú Í∞íÏùÑ ÏÑúÎ≤ÑÎ°ú Ï†ÑÏÜ°ÌïòÏó¨ AI ÏùëÎãµÏùÑ Í∞ÄÏ†∏Ïò¥
                const response = await fetch(BUILD_SERVER, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        // Message history Ï†ÑÎã¨
                        selectOption, // selectOption req.body Ï†ÑÎã¨
                        userMessages, // inputÏ∞Ω
                        gptMessages, // outputÏ∞Ω
                    }),
                });

                const responseData = await response.json();

                hideLoading();
                // ** response Message history - Gpt
                const chatGptOuput = responseData.output;
                gptMessages.push(chatGptOuput);

                // ÏÑúÎ≤ÑÏóêÏÑú Í∞ÄÏ†∏Ïò® ÏùëÎãµÏùÑ Í∏∞Î∞òÏúºÎ°ú Ï±ÑÌåÖ Î°úÍ∑∏Î•º ÏóÖÎç∞Ïù¥Ìä∏Ìï®
                const botMessage = document.createElement('div');
                botMessage.className = 'chat-message';
                botMessage.innerHTML = `
     <p>${chatGptOuput} </p>`;

                const linkText = document.createElement('p');
                linkText.classList.add('chat-pay-text');
                linkText.innerHTML = `\n ÎßÅÌÅ¨Î•º ÎàåÎü¨ÏÑú ÌõÑÏõêÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§ =>`;
                const link = document.createElement('a');
                link.classList.add('chat-pay-link');
                link.href = 'https://toss.me/codrlee';
                link.innerHTML = `ÎßàÏùå ÌëúÌòÑÌïòÍ∏∞üß°`;

                linkText.appendChild(link);
                botMessage.appendChild(linkText);

                chatLog.appendChild(botMessage);
            };

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                handleSubmit();
            });

            // select option
            const selectElement = document.querySelector('#yearOfBirth');
            const currentYear = new Date().getFullYear();
            for (let i = currentYear; i >= 2000; i -= 1) {
                const optionElement = document.createElement('option');
                optionElement.value = i;
                optionElement.textContent = i;
                selectElement.appendChild(optionElement);
            }

            // modal
            const modal = document.querySelector('.modal');
            const modalBtn = document.querySelector('.modal-btn');
            const closeContent = document.querySelector('.close');

            // When the user clicks the button, open the modal
            modalBtn.addEventListener('click', () => {
                modal.style.display = 'block';
                setTimeout(() => {
                    document.querySelector('.modal-content').style.transform =
                        'perspective(500px) rotateX(0deg) translateY(0)';
                }, 50);
            });

            closeContent.addEventListener('click', () => {
                modal.style.display = 'none';
            });

            // spinner
            const loading = document.querySelector('#loading');

            function showLoading() {
                loading.style.display = 'block';
            }

            function hideLoading() {
                loading.style.display = 'none';
            }
        </script>
        <script
            src="https://kit.fontawesome.com/ddf76d6ed0.js"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
